(()=>{"use strict";var e={203:(e,t,a)=>{a.r(t),a.d(t,{SDGoToCat:()=>_,SDGoToCatNav:()=>k,SDGoToCatNavFast:()=>v,SD_GoodFullGoodParser:()=>y,SD_GoodFullParser:()=>m,SD_GoodFullParserGetHarakteristik:()=>h,SD_GoodFullParserGetOnSklad:()=>w,SD_GoodMiniParser:()=>g,SDclickToCatBurger:()=>T,SDgetListCats:()=>M,UpModalCityClose:()=>L,checkNowCat:()=>C,checkNowGood:()=>D,clickCloseUpModal:()=>b,connect:()=>n,creatScreenshot:()=>S,exit:()=>d,getCatLink:()=>f,loadGoodsFromListCat:()=>p,loadPage:()=>x,pageScrollToBottom:()=>u,searchAndGoGood:()=>G,xPathLoadWait:()=>P,xPathLoadWaites:()=>E});const o=require("selenium-webdriver/chrome"),{Builder:r,By:l,Key:i,until:s}=require("selenium-webdriver"),c=new o.Options;c.addArguments("--window-size=1600,2080"),c.setUserPreferences({profile:{default_content_settings:{images:2},managed_default_content_settings:{images:2}}});const n=()=>(new r).forBrowser("chrome").setChromeOptions(c).usingServer("http://localhost:4444/wd/hub/").build(),d=e=>{try{e.quit(),console.log("ok exit")}catch(e){console.log("error exit",e)}},u=async(e,t=3)=>{let a=0,o=0;for(let r=1;r<=t;r++){await e.executeScript(" window.scrollBy({ top: 50000 }); "),await e.sleep(3e3);let t=await e.executeScript(" return document.body.scrollHeight ");if(o==t&&(a++,2==a))return!0;o=t}},p=async(e,t)=>{await e.wait(s.elementLocated(l.xpath('//div[@class="product"]')),1e4);const a=await e.findElements(l.xpath('//div[@class="product"]'));let o=[];for(let e of a){let a=await g(e,t);o.push(a)}return o},g=async(e,t)=>{let a={};try{let o=await e.findElement(l.xpath('./a[@class="product-name"]'));a.name=await o.getText();let r=await o.getAttribute("href");a.uri=f(r);try{let o=await e.findElement(l.xpath('./div[@class="product-code"]/span'));a.kod_str=await o.getText(),a.kod=t(a.kod_str)}catch(e){console.log("parserGoodMini ошибка скана кода")}try{let o=await e.findElement(l.xpath('./div[@class="product-buy-section"]/sd-product-price/div[@class="price"]/span[@class="main"]'));a.price_str=await o.getText(),a.price=t(a.price_str)}catch(e){console.log("parserGoodMini ошибка скана цены")}try{let t=await e.findElement(l.xpath('./div[@class="product-buy-section"]/ui-unit-tab/button'));a.price_dop=await t.getText()}catch(e){console.error("parserGoodMini ошибка скана допа к цене")}try{let t=await e.findElement(l.xpath("./ui-product-list-image/a/cx-media/img"));a.img=await t.getAttribute("src")}catch(e){console.error("parserGoodMini ошибка скана картинки")}return a}catch(e){console.log("-- parserGoodMini ошибка скана ссылки")}},h=async(e,t,a,o=0,r=!0)=>{let l=[];try{let t=await E(e,"//sd-product-attributes-view/ul/li",5);try{for(let e of t)try{let t=(await e.getText()).split("\n");o>0&&1==r&&(res={good_id:o,pole:"",value:""},res.pole=shift(t),res.value=t.join(" "),console.log("   parse har-ka ",res),await r(a,"sd_goods_options",["good_id","pole","value"],res)),l.push(t)}catch(e){console.error(771)}}catch(e){console.error(77)}}catch(e){console.error("   textName err "),console.log(e)}return l},w=async(e,t,a,o="",r)=>{let i=[];try{let s=await E(e,'//div[@class="shoplist"]/div[@class="shop"]');for(let e of s)try{let s={good_uri:o,address:"",sheldule:"",in_stock_str:"",in_stock:0,ed_izm:""};try{let t=await e.findElement(l.xpath('./div/div[@class="shop-address"]'));s.address=await t.getText()}catch(e){console.error("ошибка получения адреса")}try{let t=await e.findElement(l.xpath('./div/div[@class="shop-worktime"]'));s.sheldule=await t.getText()}catch(e){console.error("ошибка получения раб часы")}try{let i=await e.findElement(l.xpath('./div/div[@class="shop-available"]'));if(s.in_stock_str=await i.getText(),s.in_stock_str.indexOf("Привезем")>=0)console.log("  т.к. они что то привезут, значит в магазине нет");else{let e=t(s.in_stock_str);if(s.in_stock=e>0?e:0,console.log("  не привезут, есть ",s.in_stock),s.available>0){let e=s.in_stock_str.split(" ");s.ed_izm=e.pop()}""!=o&&s.in_stock>0&&await r(a,"sd_goods_in_shop",["good_uri","address","sheldule","in_stock_str","in_stock"],s)}}catch(e){console.error("ошибка получения на складе"),console.error(e)}i.push(s)}catch(e){}}catch(e){console.error("-- SD_GoodFullParserGetOnSklad err"),console.error(e)}return i},m=async(e,t={},a,o,r,l)=>{if(console.log("start SD_GoodFullParser ",t),!await D(e,t))return console.log("загружена НЕ тот товар"),!1;{console.log("загружена ТОТ товар"),await e.sleep(2e3),await u(e,3),await e.sleep(3e3);let i={options:[]};i.options=await h(e,o,r,t.uri),i.onSklad=await w(e,o,r,t.uri,l),i.good=await y(e,a,o);try{return console.log("++ SD_GoodFullParser res ",i),i}catch(e){return console.log("-- parserGoodMini ошибка скана цены"),!1}}},y=async(e,t,a)=>{let o={kod:0,price:[]};try{let t=await P(e,'//sd-product-intro/div/span[@class="code"]',5),r=await t.getText();o.kod=await a(r)}catch(e){}try{let t=await P(e,'//div[@class="content with-gradient"]',5);o.opis=await t.getText()}catch(e){console.error("   err opis")}try{let a=await P(e,"//sd-available-price/sd-price/div/div/span",5),r=await a.getText(),i={price:0,name:""};i.price=await t(r);let s=await e.findElement(l.xpath("//sd-available/ui-unit-tab/button"));i.name=await s.getText(),o.price.push(i)}catch(e){console.log("   SD_GoodFullGoodParser ошибка скана цены")}return o},f=e=>{let t=e.split("/").pop();try{return t.split("?")[0]}catch(e){return t}},x=async(e,t)=>{try{console.log("uri",t),await e.get(t)}catch(e){console.error(" loadPage / error exit"),console.error(e)}},v=async(e,t)=>{try{await T(e),await e.sleep(3e3);let a="//ui-categories-menu/ui-desktop-categories-menu/nav/div/ul[1]/li[1]/ui-custom-generic-link/a";e.executeScript(" document.evaluate('"+a+"', document, null, XPathResult.ANY_TYPE, null).href = '"+t+"' "),await e.sleep(1e3),(await e.findElement(l.xpath(a))).click(),await e.sleep(3e3)}catch(e){console.error("-- SDGoToCatNavFast err"),console.error(e)}},k=async(e,t,a="")=>{0==a.length&&(a=t.l0),await T(e);try{let o=[];t.l3&&t.l3.length>0?(o.push({l:t.l0,n:t.n0}),o.push({l:t.l1,n:t.n1}),o.push({l:t.l2,n:t.n2}),o.push({l:t.l3,n:t.n3})):t.l2&&t.l2.length>0?(o.push({l:t.l0,n:t.n0}),o.push({l:t.l1,n:t.n1}),o.push({l:t.l2,n:t.n2})):t.l1&&t.l1.length>0&&(o.push({l:t.l0,n:t.n0}),o.push({l:t.l1,n:t.n1}));let r=await _(e,o,a);return console.log("SDGoToCat 6871 ",r),await e.sleep(3e3),console.log("++-- SDGoToCatNav"),!0}catch(e){console.error("-- SDGoToCatNav err"),console.error(e)}return console.log("++-- SDGoToCatNav"),!1},_=async(e,t,a,o=1)=>{try{1==o&&await T(e);let r=await M(e,o);try{if(0==r)throw console.error(""),console.error(""),console.error(""),console.error("не получилось загрузить страницу"),console.error(""),console.error(""),console.error(""),"не получилось загрузить страницу";let l=t.pop().n;for(let i of r){let r=await i.getText();try{if((await i.getAttribute("html")).indexOf(a)>=0)return i.click(),console.log("7755 return true;"),!0}catch(e){}if(l.length>0){if(l!=r)continue;if(await e.sleep(3e3),await S(e),console.log("   gogoE.length",t.length),0==t.length){try{await i.click()}catch(e){console.error("-- 7737 ош клик")}await e.sleep(3e3),await S(e);let t=await P(e,"//sd-product-grid-header/sd-product-list-title/h1",3);return(await t.getText()).indexOf(l)>=0?(console.log("77 return true;"),!0):(console.log("77 return false;"),!1)}{let r=e.actions({async:!0});await r.move({origin:i}).perform(),await e.sleep(2e3),await S(e),await e.sleep(3e3);let l=o+1;await _(e,t,a,l)}}}}catch(e){console.log("err ---------- SDGoToCat 2 - SDgetListCats")}}catch(e){console.log("SDGoToCat: err 1 "),console.log("err",e)}},S=async(e,t="/root/ml/dist/img/11.png")=>{try{await e.takeScreenshot().then((function(e,a){require("fs").writeFile(t,e,"base64",(function(e){e&&console.log("img error",e)}))})),console.log("   screenshot good: ",t)}catch(e){console.log("ошибка создания скрина")}},b=async e=>{try{let t=await e.findElement(l.xpath('//ui-city-defined-dialog/div/div[2]/button[@class="btn-close"]'));await t.click()}catch(e){}},G=async(e,t,a)=>{try{await e.sleep(500),await S(e);let o=await e.findElement(l.xpath('//form[@class="search-form"]/div/input'));try{o.clear(),await e.sleep(50),o.sendKeys(t.name),await e.sleep(50),(await e.findElement(l.xpath('//form[@class="search-form"]/button[1]'))).click(),await e.sleep(2e3),await S(e),await e.sleep(3e3),await u(e,2),await e.sleep(500);try{let o=await E(e,'//div[@class="product"]');for(let e of o){let o=await g(e,a);try{if(console.log("good1"),console.log("good1",o.name),console.log("good1",o.kod," / ",t.kod),o.kod==t.kod){await console.log("это он! товар найден");let t=await e.findElement(l.xpath('./a[@class="product-name"]'));await t.click();break}}catch(e){console.error("ошибка перебора")}}await e.sleep(500),await S(e)}catch(e){return console.error("-- err ошибка поиска результатов поиска"),!1}}catch(e){console.log("-- err searchAndGoGood ошибка ввода или клика по форме поиска")}}catch(e){console.log("-- err searchAndGoGood ошибка поиска формы поиска")}},T=async e=>{try{await e.wait(s.elementLocated(l.xpath('//button[@class="cx-hamburger is-active"]')),3e3)}catch(t){try{let t=await e.wait(s.elementLocated(l.xpath('//ui-desktop-categories-menu/button[@class="cx-hamburger"]')),1e4);await t.click()}catch(e){return console.log(" - SDclickToCatBurger 21 ошибка клика по бургеру меню"),!1}}await S(e)},C=async(e,t)=>{try{let a=await P(e,"//sd-product-grid-header/sd-product-list-title/h1",2);if((await a.getText()).indexOf(t)>-1)return!0}catch(e){}return!1},D=async(e,t)=>{try{let a=await P(e,"//cx-page-layout/cx-page-slot[1]/sd-product-intro/h1",2);if((await a.getText()).indexOf(t.name)>-1){let a=await P(e,"//cx-page-layout/cx-page-slot[1]/sd-product-intro/div/span",2);return(await a.getText()).indexOf(t.kod),!0}}catch(e){}return!1},P=async(e,t,a=10)=>{try{return await e.wait(s.elementLocated(l.xpath(t)),1e3*a),await e.findElement(l.xpath(t))}catch(e){return console.log("err xPathLoadWait ",t),!1}},E=async(e,t,a=10)=>{try{return await e.wait(s.elementLocated(l.xpath(t)),1e3*a),await e.findElements(l.xpath(t))}catch(e){return console.log("err xPathLoadWaites ",t),!1}},L=async e=>{try{close_ip_msg=await e.wait(s.elementLocated(l.xpath('//ui-city-defined-dialog/div/div[2]/button[@class="btn-close"]')),5e3),await close_ip_msg.click(),console.log("ОК закрытия верх плашки","clickCloseUpModal")}catch(e){console.log("ошибка закрытия верх плашки","clickCloseUpModal")}},M=async(e,t)=>{console.log("++ SDgetListCats start ",t);try{return await e.wait(s.elementLocated(l.xpath("//ui-desktop-categories-menu/nav/div/ul["+t+"]")),3e3),await e.findElements(l.xpath("//ui-categories-menu/ui-desktop-categories-menu/nav/div/ul["+t+"]/li"))}catch(e){return console.log("-- SDgetListCats err"),console.log(e),!1}}}},t={};function a(o){var r=t[o];if(void 0!==r)return r.exports;var l=t[o]={exports:{}};return e[o](l,l.exports,a),l.exports}a.d=(e,t)=>{for(var o in t)a.o(t,o)&&!a.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{const{connect:e,exit:t,loadPage:o,creatScreenshot:r,pageScrollToBottom:l,clickCloseUpModal:i}=a(203);var s=e();!async function(){await(async e=>{o(s,"https://api.uralweb.info/telegram.php?s=1&token=6272013314:AAE87uoGgRkLaKnFMuW2zkUqlAeJ_e9YyUg&domain=parser.php-cat.com&msg=парсинг 1: старт "+e)})("привет конфет")}()})()})();